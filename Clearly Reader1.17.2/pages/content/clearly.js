function Clearly(t,e){if(e&&e.documentElement)t=e,e=arguments[2];else if(!t||!t.documentElement)throw new Error("First argument to Clearly constructor should be a document object.");e=e||{},this._doc=t,this._articleTitle=null,this._articleByline=null,this._articleAuthorName=null,this._articleDir=null,this._attempts=[],this._outlineIndex=0,this._debug=!!e.debug,this._maxElemsToParse=e.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=e.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=e.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(e.classesToPreserve||[]),this._root=e.root,this.websiteConfig={},this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug?this.log=function(){var t=["[CLEARY/PARSE] ",`(${arguments.callee.caller.name})`].concat(Array.from(arguments));console.debug.apply(console,t)}:this.log=function(){}}Clearly.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|foot|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|main|shadow/i,positive:/article|body|feature|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story|photo|progressive|summary/gi,negative:/hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|thumbnail|icon|emoji|widget|avatar|author|small|mini|user|footer|player|controls|button|newsletter|photoviewer-overlay|amphtml-intrinsic-sizer/gi,extraneous:/print|archive|comment|discuss|e[-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,imagePositive:/hero|presentation|gallary|cover|head|flipboard|slide|post|responsive/gi,imageNegative:/icon|logo|button|btn|material|amphtml-intrinsic-sizer/gi,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,nextLink:/(next|weiter|continue|>([^|]|$)|»([^|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,whitespace:/^\s*$/,hasContent:/\S$/},DIV_TO_P_ELEMS:["A","BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL","SELECT"],ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["CANVAS","IFRAME","ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],WEBSITE_CONFIG:{"nytimes.com/":{authorName:[".last-byline"],ignoreElements:["[data-testid=photoviewer-overlay]"]},"medium.com/":{authorName:[".pw-author a"]},"tumblr.com/":{authorName:[/"author":"(.*?)"/]},"zhuanlan.zhihu.com/":{authorName:[".AuthorInfo-content .UserLink-link"]},"jianshu.com/":{contentElem:"section article",authorName:["section span a"]},"csdn.net/":{contentElem:"article",authorName:[".follow-nickName"]},"techcrunch.com/":{authorName:[".article__byline a"]},"digitaltrends.com/":{authorName:["a.author"]},"theverge.com/":{authorName:[".c-byline__author-name"]},"nbcnews.com/":{authorName:[".byline-name a"]},"huffpost.com/":{authorName:[".entry-wirepartner__byline"]},"reuters.com/":{authorName:["[rel=author]"]},"cnn.com/":{authorName:[".metadata__byline__author a"]},"foxnews.com/":{authorName:[".author-byline a"]},"washingtonpost.com/":{authorName:["a.author-name"]},"wsj.com/":{authorName:["a.author-name"]},"abcnews.go.com/":{authorName:[".Byline__Author"]},"bbc.com/":{authorName:["article header strong"]},"mashable.com/":{contentElem:"main article",authorName:["h1 ~ div .underline-link"]},"vox.com/":{authorName:[".c-byline__author-name"]},"cnet.com/":{authorName:[".c-globalAuthor_link"]},"engadget.com/":{authorName:['[data-component="VerticalAuthorInfo"] a[class*=engadgetSteelGray]']},"entertainment14.net/":{titleElem:".entry-title",contentElem:".entry-content"},"mp.weixin.qq.com/":{authorName:[".rich_media_meta_text"],contentElem:".rich_media_content "},"sspai.com/":{authorName:[".nickname"]},"woshipm.com/":{authorName:[".ui-captionStrong"]},"36kr.com/":{authorName:[".title-icon-item"]},"infzm.com/":{authorName:[".nfzm-content__author"]},"cnbeta.com/":{authorName:[".source"]},"huxiu.com/":{authorName:[".author-info__username"]},"sciencedirect.com/":{contentElem:"article"},"wattpad.com/":{contentElem:".part-content pre"},"pcmag.com/":{contentElem:"article"}},DELAY_IMAGE_ATTRIBUTES:["data-src","datasrc","data-src","data-hi-res-src","data-original-src","data-origin","data-origin-src","data-lazyload","data-lazyload-src","data-lazy-src","data-original","data-src-medium","data-src-large","data-src-mini"],CLASSES_TO_PRESERVE:["page","hljs",/^hljs-.*/],_postProcessContent:function(t){this.log("_postProcessContent",t),this._fixRelativeUris(t),this._processAttributes(t),this._removeEmptyNodes(t),this._removeDuplicates(t)},getWebsiteConfig(t){const e=Object.keys(this.WEBSITE_CONFIG).find(e=>t.includes(e));return this.WEBSITE_CONFIG[e]||{}},_removeDuplicates:function(t){var e=[];this._removeNodes(t.querySelectorAll("img,svg"),t=>{var i=t.getAttribute("src");if(i&&e.includes(i)){if(this._hasAncestorTag(t,"figure",3)){const e=this._getNodeAncestors(t,3);for(var r=0;r<e.length;r++)if("FIGURE"===e[r].tagName){this.log("_removeDuplicates start",e[r].outerHTML),e[r].parentNode.removeChild(e[r]);break}}return!0}return e.push(i),!1})},_removeEmptyNodes:function(t){let e=this._getNextNode(t);for(;e;)this._hasContent(e,!1)||(e.parentNode.removeChild(e),this.log("_removeEmptyNodes",e.outerHTML)),e=this._getNextNode(e);let i=t;for(this.log(i);1===i.childNodes.length&&3!==i.childNodes[0].nodeType;)i.innerHTML=i.childNodes[0].innerHTML;this.log("_removeEmptyNodes after",t.outerHTML)},getPathTo(t){if(""!==t.id)return'id("'+t.id+'")';if(t===document.body)return t.tagName;for(var e=0,i=t.parentNode.childNodes,r=0;r<i.length;r++){var n=i[r];if(n===t)return this.getPathTo(t.parentNode)+"/"+t.tagName+"["+(e+1)+"]";1===n.nodeType&&n.tagName===t.tagName&&e++}},getByPath:t=>document.evaluate(t,document,null,window.XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,_getCoverPhoto(){var t=["img","svg"].concat(this.DELAY_IMAGE_ATTRIBUTES.map(function(t){return"["+t+"]"})).join(",");let e=0,i=null;return this.log("_getCoverPhoto",t),this._forEachNode(this._doc.querySelectorAll(t),t=>{const{width:r,realWidth:n,url:a}=this.getPhotoSize(t);this.log("_getCoverPhoto",r,n,t),(r>e||n>e)&&(e=r,i=a)}),!!(e>500&&i)&&(i.startsWith("//")?i=this._doc.baseURI.split(":").shift()+":"+i:i.startsWith("http")||(i=this._toAbsoluteURI(i)),i)},_removeNodes:function(t,e){for(var i=t.length-1;i>=0;i--){var r=t[i],n=r.parentNode;n&&(e&&!e.call(this,r,i,t)||(this.log("_removeNodes",r),n.removeChild(r)))}},_replaceNodeTags:function(t,e){for(var i=t.length-1;i>=0;i--){var r=t[i];this._setNodeTag(r,e)}},_forEachNode:function(t,e){Array.prototype.forEach.call(t,e,this)},_someNode:function(t,e){return Array.prototype.some.call(t,e,this)},_everyNode:function(t,e){return Array.prototype.every.call(t,e,this)},_concatNodeLists:function(){var t=Array.prototype.slice,e=t.call(arguments).map(function(e){return t.call(e)});return Array.prototype.concat.apply([],e)},_getAllNodesWithTag:function(t,e){return t.querySelectorAll?t.querySelectorAll(e.join(",")):[].concat.apply([],e.map(function(e){var i=t.getElementsByTagName(e);return Array.isArray(i)?i:Array.from(i)}))},_processAttributes:function(t){var e=(t.getAttribute("class")||"").split(/\s+/).filter(t=>-1!==this._classesToPreserve.indexOf(t)||this._classesToPreserve.some(e=>e instanceof RegExp&&e.test(t))).join(" ");for(["P","DIV","SPAN","STRONG","TABLE","UL","LI","ARTICLE","MAIN"].includes(t.tagName)&&this._cleanAttributes(t),"IMG"===t.tagName&&this._cleanAttributes(t,["src","alt","srcset"]),"A"===t.tagName&&this._cleanAttributes(t,["href","title","target","rel"]),e?t.setAttribute("class",e):t.removeAttribute("class"),t=t.firstElementChild;t;t=t.nextElementSibling)this._processAttributes(t)},_cleanAttributes:function(t,e){for(var i=t.attributes.length;i--;){var r=t.attributes[i];e&&e.includes(r.name)||t.removeAttribute(r.name)}},_buildOutline:function(t){var e=t.querySelectorAll("h1,h2,h3,h4,h5,h6"),i=[];return this._forEachNode(e,t=>{var e="ros-"+(this._outlineIndex+1);t.setAttribute("class","ros"),t.setAttribute("id",e),i.push({id:e,level:parseInt(t.tagName.substr(1),10),type:t.tagName.toLowerCase(),title:t.textContent}),this._outlineIndex++}),i},_buildLinks:function(t){var e=t.querySelectorAll("a"),i=[];return this._forEachNode(e,t=>{const e=t.getAttribute("href"),r=t.textContent&&t.textContent.trim()||"";!e||!r||r.startsWith("http")||!e.startsWith("http")||r.length<=12||i.some(t=>t.url.toLowerCase()===e.toLowerCase())||i.push({title:t.textContent.trim().replace(/[\u00A0-\u9999<>&]/g,function(t){return"&#"+t.charCodeAt(0)+";"}),type:"text",url:e,alt:t.getAttribute("alt")})}),i},_toAbsoluteURI:function(t){var e=this._doc.baseURI;if(e===this._doc.documentURI&&"#"===t.charAt(0))return t;try{return new URL(t,e).href}catch(t){}return t},_fixRelativeUris:function(t){var e=t.getElementsByTagName("a");this._forEachNode(e,t=>{var e=t.getAttribute("href");if(e)if(0===e.indexOf("javascript:")){var i=this._doc.createTextNode(t.textContent);t.parentNode.replaceChild(i,t)}else t.setAttribute("href",this._toAbsoluteURI(e))});var i=t.getElementsByTagName("img");this._forEachNode(i,t=>{var e=t.getAttribute("src");e&&!e.startsWith("data:")&&(t.setAttribute("src",this._toAbsoluteURI(e)),t.setAttribute("crossorigin","*"));for(const e of this.DELAY_IMAGE_ATTRIBUTES){const i=t.getAttribute(e);i&&(t.setAttribute("src",this._toAbsoluteURI(i)),t.setAttribute("crossorigin","*"))}const i=t.getAttribute("data-cell-options");if(i){console.log("dataCellOptions",i);try{const e=JSON.parse(i);e&&e.src&&(t.setAttribute("src",this._toAbsoluteURI(e.src)),t.setAttribute("crossorigin","*")),this.log("imgDataCellOptions process ok",t,e.src)}catch(t){this.log("imgDataCellOptions parse error",t)}}const r=t.getAttribute("srcset");r&&t.setAttribute("srcset",r.split(", ").map(t=>{const e=String(t).trim().split(" ");return e[0].startsWith("http")||e[0].startsWith("data:")?t:(e[0]=this._toAbsoluteURI(e[0]),e.join(" "))}).join(", "))});var r=t.querySelectorAll("div[data-src],span[data-original]");this._forEachNode(r,function(t){var e=t.getAttribute("data-src")||t.getAttribute("data-original");if(!t.innerHTML&&e){var i=document.createElement("img");i.src=e,i.crossorigin="*",t.parentNode.replaceChild(i,t)}})},_getArticleTitle:function(){if(this.websiteConfig.titleElem){const t=document.querySelector(this.websiteConfig.titleElem);if(t)return t.innerText}var t=this._doc,e="",i="";try{"string"!=typeof(e=i=String(t.title||"").trim())&&(e=i=this._getInnerText(t.getElementsByTagName("title")[0]))}catch(t){}var r=!1;function n(t){return t.split(/\s+/).length}if(/ [|\-\\/>»] /.test(e))r=/ [\\/>»] /.test(e),n(e=i.replace(/(.*)[|\-\\/>»] .*/gi,"$1"))<3&&(e=i.replace(/[^|\-\\/>»]*[|\-\\/>»](.*)/gi,"$1"));else if(-1!==e.indexOf(": ")){var a=this._concatNodeLists(t.getElementsByTagName("h1"),t.getElementsByTagName("h2")),s=String(e||"").trim();this._someNode(a,function(t){return String(t.textContent||"").trim()===s})||(n(e=i.substring(i.lastIndexOf(":")+1))<3?e=i.substring(i.indexOf(":")+1):n(i.substr(0,i.indexOf(":")))>5&&(e=i))}else if(e.length>150||e.length<15){var o=t.getElementsByTagName("h1");1===o.length&&(e=this._getInnerText(o[0]))}var l=n(e=String(e||"").trim());return l<=4&&(!r||l!==n(i.replace(/[|\-\\/>»]+/g,""))-1)&&(e=i),e},_prepDocument:function(){var t=this._doc;this.websiteConfig=this.getWebsiteConfig(this._doc.baseURI),this._findAuthor(),this._removeNodes(t.getElementsByTagName("style")),this._removeUnused(),t.body&&this._replaceBrs(t.body),this._replaceNodeTags(t.getElementsByTagName("font"),"SPAN")},_removeUnused:function(){this._removeNodes(this._doc.querySelectorAll(".prettyprint .pre-numbering"));const t=this.websiteConfig.ignoreElements||[];for(const e of t)this._removeNodes(this._doc.querySelectorAll(e)),this.log("_removeUnused ignoreElements",e)},_findAuthor:function(){var t=this.websiteConfig.authorName||[];for(let r of t)if("string"==typeof r){var e=this._doc.querySelector(r);e&&(this._articleAuthorName=e.innerText)}else if(r instanceof RegExp){var i=this._doc.innerHTML.match(r);i&&i[1]&&(this._articleAuthorName=i[1])}},_nextElement:function(t){for(var e=t;e&&e.nodeType!==this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(e.textContent);)e=e.nextSibling;return e},_replaceBrs:function(t){this._forEachNode(this._getAllNodesWithTag(t,["br"]),function(t){for(var e=t.nextSibling,i=!1;(e=this._nextElement(e))&&"BR"===e.tagName;){i=1;var r=e.nextSibling;e.parentNode.removeChild(e),e=r}if(i||!this._hasAncestorTag(t,"code",2)&&!this._hasAncestorTag(t,"pre",2)||(i=2),1===i){var n=this._doc.createElement("p");for(t.parentNode.replaceChild(n,t),e=n.nextSibling;e;){if("BR"===e.tagName){var a=this._nextElement(e.nextSibling);if(a&&"BR"===a.tagName)break}if(!this._isPhrasingContent(e))break;var s=e.nextSibling;n.appendChild(e),e=s}for(;n.lastChild&&this._isWhitespace(n.lastChild);)n.removeChild(n.lastChild);"P"===n.parentNode.tagName&&this._setNodeTag(n.parentNode,"DIV")}else 2===i&&t.parentNode.replaceChild(document.createTextNode("\n"),t)})},_setNodeTag:function(t,e){if(this.log(t,e),t.__JSDOMParser__)return t.localName=e.toLowerCase(),t.tagName=e.toUpperCase(),t;for(var i=t.ownerDocument.createElement(e);t.firstChild;)i.appendChild(t.firstChild);t.parentNode.replaceChild(i,t),t.Clearly&&(i.Clearly=t.Clearly);for(var r=0;r<t.attributes.length;r++)try{i.setAttribute(t.attributes[r].name,t.attributes[r].value)}catch(t){}return i},_prepArticle:function(t){this._cleanStyles(t),this._markDataTables(t),this._cleanConditionally(t,"form"),this._cleanConditionally(t,"fieldset"),this._clean(t,"object"),this._clean(t,"embed"),this._clean(t,"h1"),this._clean(t,"header"),this._clean(t,"footer"),this._clean(t,"link"),this._clean(t,"aside"),this._clean(t,"canvas"),this._forEachNode(t.children,function(t){this._cleanMatchedNodes(t,/share/)});var e=t.getElementsByTagName("h2");if(1===e.length){var i=(e[0].textContent.length-this._articleTitle.length)/this._articleTitle.length;if(Math.abs(i)<.5){(i>0?e[0].textContent.includes(this._articleTitle):this._articleTitle.includes(e[0].textContent))&&this._clean(t,"h2")}}this._clean(t,"iframe"),this._clean(t,"input"),this._clean(t,"textarea"),this._clean(t,"select"),this._clean(t,"button"),this._cleanHeaders(t),this._coverUrl=this._getCoverPhoto(t),this.log("try get getCoverPhoto",this._coverUrl),this._cleanConditionally(t,"table"),this._cleanConditionally(t,"ul"),this._cleanConditionally(t,"div"),this._cleanImg(t),this._cleanNoscript(t),this._removeNodes(t.getElementsByTagName("p"),function(t){return 0===t.getElementsByTagName("img").length+t.getElementsByTagName("embed").length+t.getElementsByTagName("object").length+t.getElementsByTagName("iframe").length&&!this._getInnerText(t,!1)}),this._forEachNode(this._getAllNodesWithTag(t,["br"]),function(t){var e=this._nextElement(t.nextSibling);e&&"P"===e.tagName&&t.parentNode.removeChild(t)}),this._forEachNode(this._getAllNodesWithTag(t,["table"]),function(t){var e=this._hasSingleTagInsideElement(t,"TBODY")?t.firstElementChild:t;if(this._hasSingleTagInsideElement(e,"TR")){var i=e.firstElementChild;if(this._hasSingleTagInsideElement(i,"TD")){var r=i.firstElementChild;r=this._setNodeTag(r,this._everyNode(r.childNodes,this._isPhrasingContent)?"P":"DIV"),t.parentNode.replaceChild(r,t)}}})},_initializeNode:function(t){switch(t.Clearly={contentScore:0},t.tagName){case"DIV":t.Clearly.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":t.Clearly.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":t.Clearly.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":t.Clearly.contentScore-=5}t.Clearly.contentScore+=this._getClassWeight(t)},_removeAndGetNext:function(t){var e=this._getNextNode(t,!0);return t.parentNode.removeChild(t),e},_getNextNode:function(t,e){if(!e&&t.firstElementChild)return t.firstElementChild;if(t.nextElementSibling)return t.nextElementSibling;do{t=t.parentNode}while(t&&!t.nextElementSibling);return t&&t.nextElementSibling},_checkByline:function(t,e){if(this._articleByline)return!1;if(void 0!==t.getAttribute)var i=t.getAttribute("rel");return!("author"!==i&&!this.REGEXPS.byline.test(e)||!this._isValidByline(t.textContent))&&(this._articleByline=String(t.textContent||"").trim(),!0)},_getNodeAncestors:function(t,e){e=e||0;for(var i=0,r=[];t.parentNode&&(r.push(t.parentNode),!e||++i!==e);)t=t.parentNode;return r},_grabArticle:function(t){const e=this._doc;var i=null!==t;t=t||this._doc.body;let r=null;if(this.websiteConfig.contentElem&&(r=this._doc.documentElement.querySelector(this.websiteConfig.contentElem))){this._ignoreCleanConditionally=!0,this.log("HTML specificCotnentElem",this.websiteConfig.contentElem,r.cloneNode(!0));let t=e.createElement("DIV");for(let e=0;e<r.childNodes.length;e++)t.innerHTML=r.outerHTML;return this._prepArticle(t),t}if(!t)return this.log("NO BODY FOUND IN DOCUMENT, ABORT."),null;var n=t.innerHTML;for(this.log("START",n);;){for(var a=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),s=[],o=this._doc.documentElement;o;){var l=o.className+" "+o.id;if(this._checkByline(o,l))this.log("REMOVE BYLINE",o),o=this._removeAndGetNext(o);else if(!a||this._hasAncestorTag(o,"code")||this._hasAncestorTag(o,"pre")||!this.REGEXPS.unlikelyCandidates.test(l)||this.REGEXPS.okMaybeItsACandidate.test(l)||"BODY"===o.tagName||"A"===o.tagName)if("DIV"!==o.tagName&&"SECTION"!==o.tagName&&"HEADER"!==o.tagName&&"H1"!==o.tagName&&"H2"!==o.tagName&&"H3"!==o.tagName&&"H4"!==o.tagName&&"H5"!==o.tagName&&"H6"!==o.tagName||!this._isElementWithoutContent(o)||this._hasDelayImageContainer(o)){if(-1!==this.DEFAULT_TAGS_TO_SCORE.indexOf(o.tagName)&&s.push(o),"DIV"===o.tagName&&!this._isDelayImageContainer(o)){for(var h=null,c=o.firstChild;c;){var g=c.nextSibling;if(this._isPhrasingContent(c))null!==h?h.appendChild(c):this._isWhitespace(c)||(h=e.createElement("p"),o.replaceChild(h,c),h.appendChild(c));else if(null!==h){for(;h.lastChild&&this._isWhitespace(h.lastChild);)h.removeChild(h.lastChild);h=null}c=g}if(this._hasSingleTagInsideElement(o,"P")&&this._getLinkDensity(o)<.25){var u=o.children[0];o.parentNode.replaceChild(u,o),o=u,s.push(o)}else this._hasChildBlockElement(o)||(o=this._setNodeTag(o,"P"),s.push(o))}o=this._getNextNode(o)}else this.log("REMOVE EMPTY CONTENT",o),o=this._removeAndGetNext(o);else this.log("REMOVE UNLIKELY CANDIDATE",o),o=this._removeAndGetNext(o)}var d=[];this._forEachNode(s,function(t){if(t.parentNode&&void 0!==t.parentNode.tagName){var e=this._getInnerText(t);if(!(e.length<25)){var i=this._getNodeAncestors(t,3);if(0!==i.length){var r=0;r+=1,r+=e.split(",").length,r+=Math.min(Math.floor(e.length/100),3),this._forEachNode(i,function(t,e){if(t.tagName&&t.parentNode&&void 0!==t.parentNode.tagName){if(void 0===t.Clearly&&(this._initializeNode(t),d.push(t)),0===e)var i=1;else i=1===e?2:3*e;t.Clearly.contentScore+=r/i}})}}}});for(var m=[],_=0,N=d.length;_<N;_+=1){var f=d[_],E=f.Clearly.contentScore*(1-this._getLinkDensity(f));f.Clearly.contentScore=E;for(var p=0;p<this._nbTopCandidates;p++){var T=m[p];if(!T||E>T.Clearly.contentScore){m.splice(p,0,f),m.length>this._nbTopCandidates&&this.log("Remove topCandidate:",E,T.Clearly.contentScore,m.pop());break}}}var A,v=m[0]||null,b=!1;if(null===v||"BODY"===v.tagName){v=e.createElement("DIV"),b=!0;for(var C=t.childNodes;C.length;)this.log("THROW CHILD",C[0]),v.appendChild(C[0]);t.appendChild(v),this._initializeNode(v)}else if(v){for(var y=[],S=1;S<m.length;S++)m[S].Clearly.contentScore/v.Clearly.contentScore>=.75&&y.push(this._getNodeAncestors(m[S]));if(y.length>=3)for(A=v.parentNode;A&&"BODY"!==A.tagName;){for(var I=0,L=0;L<y.length&&I<3;L++)I+=Number(y[L].includes(A));if(I>=3){v=A;break}A=A.parentNode}v.Clearly||this._initializeNode(v),A=v.parentNode;for(var R=v.Clearly.contentScore,D=R/3;A&&"BODY"!==A.tagName;)if(A.Clearly){var x=A.Clearly.contentScore;if(x<D)break;if(x>R){v=A;break}R=A.Clearly.contentScore,A=A.parentNode}else A=A.parentNode;for(A=v.parentNode;"BODY"!==A.tagName&&1===A.children.length;)A=(v=A).parentNode;v.Clearly||this._initializeNode(v)}let r=e.createElement("DIV");i&&(r.id="clearly-content");for(var B=Math.max(10,.2*v.Clearly.contentScore),O=(A=v.parentNode).children,P=0,w=O.length;P<w;P++){var M=O[P],U=!1;if(this.log("SIBLING",M,M.Clearly?"with score "+M.Clearly.contentScore:""),this.log("SIBLING SCORE",M.Clearly?M.Clearly.contentScore:"Unknown",v),M===v)U=!0;else{var G=0;if(M.className===v.className&&""!==v.className&&(G+=.2*v.Clearly.contentScore),M.Clearly&&M.Clearly.contentScore+G>=B)U=!0;else if("P"===M.nodeName){var H=this._getLinkDensity(M),k=this._getInnerText(M),W=k.length;W>80&&H<.25?U=!0:W<80&&W>0&&0===H&&-1!==k.search(/\.( |$)/)?U=!0:["FIGURE","PICTURE"].includes(M.nodeName)&&this._hasDelayImageContainer(M)&&(U=!0)}}U&&(this.log("SIBLING APPEND",M),-1===this.ALTER_TO_DIV_EXCEPTIONS.indexOf(M.nodeName)&&(this.log("SIBLING ALTER",M,"to div."),M=this._setNodeTag(M,"DIV")),r.appendChild(M),P-=1,w-=1)}if(this.log("HTML AFTER CLEAN",r.cloneNode(!0)),this._prepArticle(r),this.log("HTML AFTER PREP",r.cloneNode(!0)),b)v.id="clearly-page-1",v.className="clearly-page";else{var F=e.createElement("DIV");F.id="clearly-page-1",F.className="clearly-page";for(var V=r.childNodes;V.length;)F.appendChild(V[0]);r.appendChild(F)}this.log("HTML AFTER PAGING",r.cloneNode(!0));var Y=!0,X=this._getInnerText(r,!0).length;if(X<this._charThreshold)if(Y=!1,t.innerHTML=n,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:r,textLength:X});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:r,textLength:X});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:r,textLength:X});else{if(this._attempts.push({articleContent:r,textLength:X}),this._attempts.sort(function(t,e){return t.textLength<e.textLength}),!this._attempts[0].textLength)return this.log("MAX TRIES LIMIT"),null;r=this._attempts[0].articleContent,Y=!0}if(Y){var j=[A,v].concat(this._getNodeAncestors(A));return this._someNode(j,function(t){if(!t.tagName)return!1;var e=t.getAttribute("dir");return!!e&&(this._articleDir=e,!0)}),r}}},_cleanNoscript(t){var e=t.getElementsByTagName("noscript");this._forEachNode(e,t=>{var e=t.textContent.trim();if(this.log("check noscript",e),!e.startsWith("<img "))return;const i=t.parentNode;if(t.previousSibling&&!("IMG"!==t.previousSibling.tagName||t.previousSibling.getAttribute("src")&&t.previousSibling.getAttribute("src").startsWith("http"))){const r=document.createElement("span");r.innerHTML=e,i.replaceChild(r,t.previousSibling),i.removeChild(t),this.log("replace noscript",r,t,t.previousSibling)}}),this._clean(t,"noscript")},_isValidByline:function(t){return("string"==typeof t||t instanceof String)&&((t=String(t||"").trim()).length>0&&t.length<100)},_getArticleMetadata:function(){var t={},e={},i=this._doc.getElementsByTagName("meta"),r=/\s*(dc|dcterm|og|twitter)\s*:\s*(author|creator|description|title)\s*/gi,n=/^\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\s*[.:]\s*)?(author|creator|description|title)\s*$/i;return this._forEachNode(i,function(t){var i=t.getAttribute("name"),a=t.getAttribute("property"),s=t.getAttribute("content"),o=null,l=null;if(a&&(o=a.match(r)))for(var h=o.length-1;h>=0;h--)l=o[h].toLowerCase().replace(/\s/g,""),e[l]=String(s||"").trim();!o&&i&&n.test(i)&&(l=i,s&&(l=l.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),e[l]=String(s||"").trim()))}),t.title=e["dc:title"]||e["dcterm:title"]||e["og:title"]||e["weibo:article:title"]||e["weibo:webpage:title"]||e.title||e["twitter:title"],t.title||(t.title=this._getArticleTitle()),t.byline=e["dc:creator"]||e["dcterm:creator"]||e.author,t.excerpt=e["dc:description"]||e["dcterm:description"]||e["og:description"]||e["weibo:article:description"]||e["weibo:webpage:description"]||e.description||e["twitter:description"],t},_removeScripts:function(t){this._removeNodes(t.getElementsByTagName("script"),function(t){return t.nodeValue="",t.removeAttribute("src"),!0})},_hasSingleTagInsideElement:function(t,e){return 1===t.children.length&&t.children[0].tagName===e&&!this._someNode(t.childNodes,function(t){return t.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(t.textContent)})},_isElementWithoutContent:function(t){return t.nodeType===this.ELEMENT_NODE&&0===String(t.textContent||"").trim().length&&(0===t.children.length||t.children.length===t.getElementsByTagName("br").length+t.getElementsByTagName("hr").length)},_isDelayImageContainer:function(t){return this.DELAY_IMAGE_ATTRIBUTES.some(function(e){return t.hasAttribute(e)})},_hasDelayImageContainer:function(t){var e=this.DELAY_IMAGE_ATTRIBUTES.map(function(t){return"["+t+"]"}).join(",")+",img";return t.querySelectorAll(e).length>0},_hasChildBlockElement:function(t){return this._someNode(t.childNodes,function(t){return-1!==this.DIV_TO_P_ELEMS.indexOf(t.tagName)||this._hasChildBlockElement(t)})},_isPhrasingContent:function(t){return t.nodeType===this.TEXT_NODE||-1!==this.PHRASING_ELEMS.indexOf(t.tagName)||("A"===t.tagName||"DEL"===t.tagName||"INS"===t.tagName)&&this._everyNode(t.childNodes,this._isPhrasingContent)},_isWhitespace:function(t){return t.nodeType===this.TEXT_NODE&&0===String(t.textContent||"").trim().length||t.nodeType===this.ELEMENT_NODE&&"BR"===t.tagName},_hasContent:function(t){return!!this._getInnerText(t,!1)||!!t.getElementsByTagName("img")},_getInnerText:function(t,e){e=void 0===e||e;var i=String(t.textContent||"").trim();return e?i.replace(this.REGEXPS.normalize," "):i},_getInnerPhotos:function(t){var e=["img","svg"].concat(this.DELAY_IMAGE_ATTRIBUTES.map(function(t){return"["+t+"]"})).join(",");let i=0;return this._forEachNode(t.querySelectorAll(e),t=>{this.isRealPhoto(t)&&i++}),i},isRealPhoto:function(t){if(this._isDelayImageContainer(t))return!0;const e=this.getPhotoSize(t);return!!Object.values(e).find(t=>t>300)},getPhotoSize:function(t){var e=Object.values(t.attributes).map(t=>t.nodeName),i=e.find(t=>t.includes("width")),r=e.find(t=>t.includes("height")),n=t.clientWidth,a=t.clientHeight;let s=0,o=0,l=t.getAttribute("src");if(i&&(n=parseInt(t.getAttribute(i),10)||n),r&&(a=parseInt(t.getAttribute(r),10)||a),"svg"===t.tagName&&t.hasAttribute("viewBox")){const[,,e,i]=t.getAttribute("viewBox").split(" ");e&&(n=parseInt(e,10)),i&&(a=parseInt(i,10))}if(t.hasAttribute("src")&&t.complete&&(o=t.naturalHeight,s=t.naturalWidth),t.getAttribute("srcset")){const e=t.getAttribute("srcset").split(",").reduce((t,e)=>{let[i,r]=e.trim().split(" ");return(r=parseInt(r))>t.width?{width:r,url:i}:t},{width:0,url:""});e&&e.url&&(n=e.width,l=e.url)}return{width:n,height:a,realWidth:s,realHeight:o,url:l}},_getCharCount:function(t,e){return e=e||",",this._getInnerText(t).split(e).length-1},_cleanStyles:function(t){if(t&&"svg"!==t.tagName.toLowerCase()){for(var e=0;e<this.PRESENTATIONAL_ATTRIBUTES.length;e++)t.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[e]);-1!==this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(t.tagName)&&(t.removeAttribute("width"),t.removeAttribute("height"));for(var i=t.firstElementChild;null!==i;)this._cleanStyles(i),i=i.nextElementSibling}},_getLinkDensity:function(t){var e=this._getInnerText(t).length;if(0===e)return 0;var i=0;return this._forEachNode(t.getElementsByTagName("a"),function(t){i+=this._getInnerText(t).length}),i/e},_getClassWeight:function(t){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var e=0,i=(t.className||"")+":"+(t.id||"");if(t.className||t.id){var r=i.match(this.REGEXPS.negative);r&&(e-=25*r.length);var n=i.match(this.REGEXPS.positive);n&&(e+=25*n.length),["SVG","IMG"].includes(t.tagName.toUpperCase())&&(this.REGEXPS.imageNegative.test(t.className)&&(e-=25),this.REGEXPS.imagePositive.test(t.className)&&(e+=25))}return e},_clean:function(t,e){var i=-1!==["object","embed","iframe"].indexOf(e);this.log("_clean",e,i),this._removeNodes(t.getElementsByTagName(e),function(t){if(i){var e=[].map.call(t.attributes,function(t){return t.value}).join("|");if(this.REGEXPS.videos.test(e))return!1;if(this.REGEXPS.videos.test(t.innerHTML))return!1}return!0})},_hasPhotoContainer:function(t){return this._hasAncestorTag(t,"figure")||this._hasAncestorTag(t,"picture")},_hasAncestorTag:function(t,e,i,r){i=i||3,e=e.toUpperCase();for(var n=0;t.parentNode;){if(i>0&&n>i)return!1;if(t.parentNode.tagName===e&&(!r||r(t.parentNode)))return!0;t=t.parentNode,n++}return!1},_getRowAndColumnCount:function(t){for(var e=0,i=0,r=t.getElementsByTagName("tr"),n=0;n<r.length;n++){var a=r[n].getAttribute("rowspan")||0;a&&(a=parseInt(a,10)),e+=a||1;for(var s=0,o=r[n].getElementsByTagName("td"),l=0;l<o.length;l++){var h=o[l].getAttribute("colspan")||0;h&&(h=parseInt(h,10)),s+=h||1}i=Math.max(i,s)}return{rows:e,columns:i}},_markDataTables:function(t){for(var e=t.getElementsByTagName("table"),i=0;i<e.length;i++){var r=e[i];if("presentation"!==r.getAttribute("role"))if("0"!==r.getAttribute("datatable"))if(r.getAttribute("summary"))r._ClearlyDataTable=!0;else{var n=r.getElementsByTagName("caption")[0];if(n&&n.childNodes.length>0)r._ClearlyDataTable=!0;else{if(["col","colgroup","tfoot","thead","th"].some(function(t){return!!r.getElementsByTagName(t)[0]}))this.log("DATA TABLE BECAUSE FOUND DATA-Y DESCENDANT"),r._ClearlyDataTable=!0;else if(r.getElementsByTagName("table")[0])r._ClearlyDataTable=!1;else{var a=this._getRowAndColumnCount(r);a.rows>=10||a.columns>4?r._ClearlyDataTable=!0:r._ClearlyDataTable=a.rows*a.columns>10}}}else r._ClearlyDataTable=!1;else r._ClearlyDataTable=!1}},_cleanImg:function(t){this.log("_cleanImg start",t);var e=["img","svg"].concat(this.DELAY_IMAGE_ATTRIBUTES.map(function(t){return"["+t+"]"})).join(",");this._removeNodes(t.querySelectorAll(e),t=>{var e=t.hasAttribute("data-srcset")||t.hasAttribute("srcset"),i=t.nodeName.toUpperCase();if(e||this._isDelayImageContainer(t))return!1;var r=this._getClassWeight(t);if(this.log("_cleanImg executed executed with weight",r,0,t),r+0<0)return!0;if(this._hasPhotoContainer(t))return!1;if(["IMG","SVG"].includes(i)){let e=!1;if(this._root&&t.hasAttribute("src")&&(e=!0,t=this._root.querySelector(`${t.tagName.toLowerCase()}[src="${t.getAttribute("src")}"]`)),t.hasAttribute("src")&&t.complete)return!!(e&&(t.naturalWidth<250||t.naturalHeight<250||t.naturalHeight/t.naturalWidth>3||t.naturalHeight/t.naturalWidth<.2)||t.getAttribute("width")&&t.getAttribute("width")<100||t.getAttribute("height")&&t.getAttribute("height")<100)&&(this.log("_cleanImg after load",t,t.naturalWidth,t.naturalHeight,t),!0);var n=Object.values(t.attributes).map(t=>t.nodeName),a=n.find(t=>t.includes("width")),s=n.find(t=>t.includes("height")),o=t.clientWidth,l=t.clientHeight;if(a&&(o=parseInt(t.getAttribute(a),10)||o),s&&(l=parseInt(t.getAttribute(s),10)||l),"SVG"===i&&t.hasAttribute("viewBox")){const[,,e,i]=t.getAttribute("viewBox").split(" ");e&&(o=parseInt(e,10)),i&&(l=parseInt(i,10))}if(o<=250&&l<=250||l/o>3||l/o<.33)return this.log("_cleanImg base attrs",t.naturalWidth,t.clientHeight,t),!0}return!1})},_cleanConditionally:function(t,e){if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&!this._ignoreCleanConditionally){var i="ul"===e||"ol"===e;this._removeNodes(t.getElementsByTagName(e),function(t){if(this._hasAncestorTag(t,"table",-1,function(t){return t._ClearlyDataTable}))return!1;var e=this._getClassWeight(t);if(this._getCharCount(t,",")<10){for(var r=t.getElementsByTagName("p").length||t.getElementsByTagName("td").length||t.getElementsByTagName("th").length,n=t.getElementsByTagName("img").length,a=t.getElementsByTagName("li").length-100,s=t.getElementsByTagName("input").length,o=0,l=t.getElementsByTagName("embed"),h=0,c=l.length;h<c;h+=1)this.REGEXPS.videos.test(l[h].src)||(o+=1);var g=this._getLinkDensity(t),u=this._getInnerText(t).length,d=n>1&&r/n<.5||i&&!u&&!n||!i&&a>r||s>Math.floor(r/3)||!i&&u<25&&(0===n||n>2)||!i&&0===n&&e<25&&g>.2||e>=25&&g>.5||1===o&&u<75||o>1;return d&&this.log("CLEANCONDITIONALLY BY RULES",{img:n,isList:i,contentLength:u,p:r,li:a,linkDensity:g,weight:e,embedCount:o},t),d}return e+0<0&&(this.log("CLEANCONDITIONALLY BY SCORE",e+0,t),!0)})}},_cleanMatchedNodes:function(t,e){for(var i=this._getNextNode(t,!0),r=this._getNextNode(t);r&&r!==i;)e.test(r.className+" "+r.id)?(this.log("REMOVE BY REGEX",e,r),r=this._removeAndGetNext(r)):r=this._getNextNode(r)},_cleanHeaders:function(t){for(var e=1;e<3;e+=1)this._removeNodes(t.getElementsByTagName("h"+e),function(t){return this._getClassWeight(t)<0})},_flagIsActive:function(t){return(this._flags&t)>0},_removeFlag:function(t){this._flags=this._flags&~t},_isRealVisible:function(t){var e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&e.opacity>0&&!t.hasAttribute("hidden")},_isProbablyVisible:function(t){return!(t.style&&"none"===t.style.display||t.hasAttribute("hidden"))},isProbablyReaderable:function(t){var e=this._getAllNodesWithTag(this._doc,["p","pre"]),i=this._getAllNodesWithTag(this._doc,["div > br"]);if(i.length){var r=new Set;[].forEach.call(i,function(t){r.add(t.parentNode)}),e=[].concat.apply(Array.from(r),e)}t||(t=this._isProbablyVisible);var n=0;return this._someNode(e,function(e){if(t&&!t(e))return!1;var i=e.className+" "+e.id;if(this.REGEXPS.unlikelyCandidates.test(i)&&!this.REGEXPS.okMaybeItsACandidate.test(i))return!1;if(e.matches&&e.matches("li p"))return!1;var r=String(e.textContent||"").trim().length;return!(r<140)&&(n+=Math.sqrt(r-140))>20})},parse:function(){if(this._maxElemsToParse>0){var t=this._doc.getElementsByTagName("*").length;if(t>this._maxElemsToParse)throw new Error("Aborting parsing document; "+t+" elements found")}this._prepDocument(),this._removeScripts(this._doc);var e=this._getArticleMetadata();this._articleTitle=e.title;var i=this._grabArticle(),r=i&&i.textContent?i.textContent.trim():"";if(!r||r.length<100&&i.querySelectorAll("img").length<2)return null;this.log("HTML GRAB",i.cloneNode(!0)),this._postProcessContent(i),this.log("HTML PROCESS",i.cloneNode(!0));var n=this._buildOutline(i),a=this._buildLinks(i);if(!e.excerpt){var s=i.getElementsByTagName("p");s.length>0&&(e.excerpt=String(s[0].textContent||"").trim())}var o=i.textContent,l=i.innerHTML.includes(this._coverUrl)?null:this._coverUrl;return{url:i.baseURI,title:this._articleTitle,coverUrl:l,byline:e.byline||this._articleByline,dir:this._articleDir,content:"<article>"+i.innerHTML+"</article>",textContent:o,length:o.length,excerpt:e.excerpt,outline:n,links:a,authorName:this._articleAuthorName,hostname:new URL(this._doc.baseURI).hostname}}},"object"==typeof module&&(module.exports=Clearly);